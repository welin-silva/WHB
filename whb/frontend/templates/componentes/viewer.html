<div class="viewer-card" id="cardToFullscreen"> 
    <h2 data-i18n="VIEWER.TITLE"></h2>
    
    <button id="btnFullscreen" class="fullscreen-btn" title="Pantalla Completa">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
        </svg>
    </button>

    <div class="viewer-container">

        <!-- VIDEO ORIGINAL -->
        <video id="video"
               class="img-layer"
               style="object-fit: cover; z-index: 1;"
               autoplay
               playsinline>
        </video>
        
        <!-- VIDEO FILTRADO -->
        <video id="videoFiltered"
               class="img-layer top-layer"
               style="object-fit: cover; z-index: 2;"
               autoplay
               playsinline>
        </video>

        <!-- CANVAS MEDIAPIPE (NUEVO) -->
        <canvas
            id="faceMeshCanvas"
            class="img-layer" 
            style="
                position:absolute;
                top:0;
                left:0;
                width:100%;
                height:100%;
                z-index: 20; /* Subimos el z-index para que esté encima del slider y textos */
                pointer-events:none;">
        </canvas>


        <!-- COMPARADOR DE IMÁGENES -->
        <div id="compareWrapper" class="compare-wrapper" style="z-index: 3;">
            <img id="imgOriginal" class="img-layer" alt="Original">
            <img id="imgFiltered" class="img-layer top-layer" alt="Con crema">
        </div>

        <!-- DIVISOR -->
        <div class="compare-divider"
             id="divider"
             style="z-index: 10; display: none;">
        </div>

        <!-- TEXTO CUANDO NO HAY IMAGEN -->
        <div id="noImageText"
             class="no-image-content"
             style="z-index: 20;">
            <p data-i18n="VIEWER.NO_IMAGE"></p>
            <div class="center-actions">
                <button id="btnSelfieCenter"
                        class="btn btn-primary"
                        onclick="iniciarCamaraYCapturar()"
                        data-i18n="VIEWER.SELFIE_MODE">
                </button>

                <input type="file"
                       id="fileInputCenter"
                       accept="image/*"
                       hidden>

                <label for="fileInputCenter"
                       class="btn btn-secondary"
                       data-i18n="VIEWER.UPLOAD_PHOTO">
                </label>
            </div>
        </div>
    </div>

    <!-- SLIDER -->
    <div class="slider-row"
         id="mainSliderRow"
         style="display: none;">
        <label for="compareSlider"
               data-i18n="VIEWER.SLIDER_LABEL">
        </label>
        <input type="range"
               id="compareSlider"
               min="0"
               max="100"
               value="50">
    </div>

    <!-- PRODUCTOS -->
    <div class="products-strip-container">
        <h3 data-i18n="VIEWER.PRODUCTS_TITLE"></h3>
        <div class="products-strip">
            {% for p in productos %}
            <div class="product-thumb" data-product-id="{{ p.id }}">
                <div class="thumb-img">
                    <img src="{{ p.imagen_url }}" alt="{{ p.nombre }}">
                </div>
                <span class="thumb-name">{{ p.nombre }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
